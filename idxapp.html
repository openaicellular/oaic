

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Deploying the Intrusion Detection xApp &mdash; OAIC 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=2709fde1"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="UnDeploying RIC Platform" href="undeploy_ric.html" />
    <link rel="prev" title="Running the SS Xapp" href="ssxapp.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            OAIC
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="oaic_features.html">OAIC Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Background Information:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="background_cloud.html">Background on Docker, Kubernetes &amp; Helm</a></li>
<li class="toctree-l1"><a class="reference internal" href="background_oran_architecture.html">O-RAN Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="background_srsRAN.html">RAN Architecture</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation Procedures:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">Hardware and Software Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="oran_installation.html">O-RAN Near-Real Time RIC Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="srsRAN_installation.html">srsRAN with E2 Agent Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup5gnetwork.html">Setup your own 5G Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="MultipleUEs.html">Multiples UEs ZMQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="nonrtric.html">O-RAN Non-Real Time RIC Installation Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">xApp Deployment:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="example_xapp_deployment.html">KPIMON xApp Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="xapp_deployment.html">xApp Deployment - General Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="nexran1.html">Running the Nexran Xapp</a></li>
<li class="toctree-l1"><a class="reference internal" href="ssxapp.html">Running the SS Xapp</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Deploying the Intrusion Detection xApp</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#table-of-contents">Table of Contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#system-requirements">System Requirements</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#setup">Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setup-near-realtime-ric">Setup - Near-Realtime RIC</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-kubernetes-docker-and-helm">Install Kubernetes, Docker, and Helm</a></li>
<li class="toctree-l3"><a class="reference internal" href="#one-time-setup-for-influxdb">One time setup for Influxdb</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pull-modified-e2-docker-image">Pull Modified E2 docker image</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#deploy-near-realtime-ric">Deploy Near-Realtime RIC</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setup-srslte-with-e2-agent">Setup - Srslte with E2 Agent</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installing-asn1c-compiler">Installing Asn1c compiler</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-srslte-from-source">Install Srslte from source</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setup-nginx-web-server">Setup - Nginx Web Server</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#setup-intrusion-detection-with-xapp">Setup - Intrusion Detection with xApp</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#modify-srslte">Modify Srslte</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-xapp">Installing xApp</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#setup-5g-network">Setup - 5G Network</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#srsepc">Srsepc</a></li>
<li class="toctree-l3"><a class="reference internal" href="#srsenb">Srsenb</a></li>
<li class="toctree-l3"><a class="reference internal" href="#srsue">Srsue</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gnuradio">Gnuradio</a></li>
<li class="toctree-l3"><a class="reference internal" href="#iperf3">Iperf3</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#deploying-the-xapp">Deploying the xApp</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-xapp">Running the xApp</a></li>
<li class="toctree-l2"><a class="reference internal" href="#getting-cuda-on-the-app">Getting CUDA On The App</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configure-docker-to-run-with-cuda">Configure Docker to Run with CUDA</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="undeploy_ric.html">UnDeploying RIC Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="srsRAN_additional_features.html">srsRAN Additional Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="kubectl_commands.html">Kubectl Commands - Cheat Sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="oaic_t.html">OAIC-T</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">2024 OAIC Workshop</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="2024_workshop_gcp.html">Day 1 - Google Cloud Platform Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="2024_workshop_ss.html">Day 1 - Secure Slicing xApp</a></li>
<li class="toctree-l1"><a class="reference internal" href="xapp_python.html">Day 2 - Developing a custom xApp in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="edgeric-workshop-tutorial.html">Day 2 - EdgeRIC tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="OAIC-2024-Workshop-oai-flexric-documentation.html">Day 2 - OAI/FlexRIC Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="OAIC-T-fast-setup.html">Day 3 - OAIC-T</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">OAIC</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Deploying the Intrusion Detection xApp</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/idxapp.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="deploying-the-intrusion-detection-xapp">
<h1>Deploying the Intrusion Detection xApp<a class="headerlink" href="#deploying-the-intrusion-detection-xapp" title="Link to this heading"></a></h1>
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="ssxapp.html#prerequisites"><span class="std std-ref">Prerequisites</span></a></p></li>
<li><p><a class="reference internal" href="#ric-setup"><span class="std std-ref">Setup</span></a></p></li>
<li><p><a class="reference internal" href="#setup-srslte"><span class="std std-ref">Setup - Srslte with E2 Agent</span></a></p></li>
<li><p><a class="reference internal" href="#setup-nginx"><span class="std std-ref">Setup - Nginx Web Server</span></a></p></li>
<li><p><a class="reference internal" href="#setup-id"><span class="std std-ref">Setup - Intrusion Detection with xApp</span></a></p></li>
<li><p><span class="xref std std-ref">Setup-5G</span></p></li>
<li><p><a class="reference internal" href="ssxapp.html#deploying"><span class="std std-ref">Deploying the SS xApp</span></a></p></li>
<li><p><a class="reference internal" href="#running-the-xapp"><span class="std std-ref">Running the xApp</span></a></p></li>
<li><p><span class="xref std std-ref">Enabling-CUDA</span></p></li>
</ul>
</section>
<section id="prerequisites">
<span id="id1"></span><h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading"></a></h2>
<section id="system-requirements">
<h3>System Requirements<a class="headerlink" href="#system-requirements" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>OS: <a class="reference external" href="https://www.releases.ubuntu.com/focal/ubuntu-20.04.6-desktop-amd64.iso">Ubuntu Desktop 20.04 LTS (Focal Fossa)</a> Baremetal Preferred</p></li>
<li><p><a class="reference external" href="https://unix.stackexchange.com/questions/739769/how-do-you-install-the-linux-lowlatency-kernel-and-why-does-it-stops-at-version">Low Latency Kernel recommended</a></p></li>
<li><p><a class="reference external" href="https://askubuntu.com/questions/604720/setting-to-high-performance">Performance mode setting</a></p></li>
<li><p>CPU(s): 12 vCPUs (Threads)</p></li>
<li><p>RAM: 16 GB minimum</p></li>
<li><p>Storage: 100 GB</p></li>
</ul>
<p>Install packages</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span>-y
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>git<span class="w"> </span>vim<span class="w"> </span>tmux<span class="w"> </span>build-essential<span class="w"> </span>cmake<span class="w"> </span>libfftw3-dev<span class="w"> </span>libmbedtls-dev<span class="w"> </span>libboost-program-options-dev<span class="w"> </span>libconfig++-dev<span class="w"> </span>libsctp-dev<span class="w"> </span>libtool<span class="w"> </span>autoconf<span class="w"> </span>gnuradio<span class="w"> </span>python3-pip<span class="w"> </span>iperf3<span class="w"> </span>libzmq3-dev<span class="w"> </span>-y
</pre></div>
</div>
</section>
</section>
<section id="setup">
<span id="ric-setup"></span><h2>Setup<a class="headerlink" href="#setup" title="Link to this heading"></a></h2>
<section id="setup-near-realtime-ric">
<h3>Setup - Near-Realtime RIC<a class="headerlink" href="#setup-near-realtime-ric" title="Link to this heading"></a></h3>
<p>Clone OAIC and Install Submodules</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/openaicellular/oaic.git
<span class="nb">cd</span><span class="w"> </span>oaic
git<span class="w"> </span>submodule<span class="w"> </span>update<span class="w"> </span>--init<span class="w"> </span>--recursive<span class="w"> </span>--remote
</pre></div>
</div>
</section>
<section id="install-kubernetes-docker-and-helm">
<h3>Install Kubernetes, Docker, and Helm<a class="headerlink" href="#install-kubernetes-docker-and-helm" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/oaic/RIC-Deployment/tools/k8s/bin
git<span class="w"> </span>checkout<span class="w"> </span>kubernetes-fix
./gen-cloud-init.sh
sudo<span class="w"> </span>./k8s-1node-cloud-init-k_1_16-h_2_17-d_cur.sh
</pre></div>
</div>
<p>You can check if all the pods in the Kubernetes Cluster are in “Running” state by using,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-A
</pre></div>
</div>
<p>NOTE: There is an issue with with this setup at the moment. Uninstalling docker and installing an older verison will fix it</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt-get<span class="w"> </span>purge<span class="w"> </span>-y<span class="w"> </span>docker-engine<span class="w"> </span>docker<span class="w"> </span>docker.io<span class="w"> </span>docker-ce<span class="w"> </span>docker-ce-cli
sudo<span class="w"> </span>apt-get<span class="w"> </span>autoremove<span class="w"> </span>-y<span class="w"> </span>--purge<span class="w"> </span>docker-engine<span class="w"> </span>docker<span class="w"> </span>docker.io<span class="w"> </span>docker-ce
sudo<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/var/lib/docker<span class="w"> </span>/etc/docker
apt-cache<span class="w"> </span>madison<span class="w"> </span>docker-ce
</pre></div>
</div>
<p>This will list the available versions for install. Install the oldest verion listed.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>docker-ce<span class="o">=</span>&lt;VERSION&gt;<span class="w"> </span>docker-ce-cli<span class="o">=</span>&lt;VERSION&gt;<span class="w"> </span>containerd.io
</pre></div>
</div>
</section>
<section id="one-time-setup-for-influxdb">
<h3>One time setup for Influxdb<a class="headerlink" href="#one-time-setup-for-influxdb" title="Link to this heading"></a></h3>
<p>Create a ricinfra namespace</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>kubectl<span class="w"> </span>create<span class="w"> </span>ns<span class="w"> </span>ricinfra
</pre></div>
</div>
<p>Install the nfs-common package for Influxdb setup</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>helm<span class="w"> </span>install<span class="w"> </span>stable/nfs-server-provisioner<span class="w"> </span>--namespace<span class="w"> </span>ricinfra<span class="w"> </span>--name<span class="w"> </span>nfs-release-1
sudo<span class="w"> </span>kubectl<span class="w"> </span>patch<span class="w"> </span>storageclass<span class="w"> </span>nfs<span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;{&quot;metadata&quot;: {&quot;annotations&quot;:{&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;}}}&#39;</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>nfs-common<span class="w"> </span>-y
</pre></div>
</div>
<p>When the RIC platform is undeployed, the <code class="docutils literal notranslate"><span class="pre">ricinfra</span></code> namespace will also be removed. So, you will need to run the one-time setup procedure again when re-deploying the RIC.</p>
</section>
<section id="pull-modified-e2-docker-image">
<h3>Pull Modified E2 docker image<a class="headerlink" href="#pull-modified-e2-docker-image" title="Link to this heading"></a></h3>
<p>You’re required a local docker registry to host docker images. You can create one using this command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">5001</span>:5000<span class="w"> </span>--restart<span class="o">=</span>always<span class="w"> </span>--name<span class="w"> </span>ric<span class="w"> </span>registry:2
</pre></div>
</div>
<p>Pull the E2 termination docker image from the OAIC’s DockerHub and retagging it to be hosted in the local registry</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>pull<span class="w"> </span>oaic/e2:5.5.0
sudo<span class="w"> </span>docker<span class="w"> </span>tag<span class="w"> </span>oaic/e2:5.5.0<span class="w"> </span>localhost:5001/ric-plt-e2:5.5.0
sudo<span class="w"> </span>docker<span class="w"> </span>push<span class="w"> </span>localhost:5001/ric-plt-e2:5.5.0
</pre></div>
</div>
</section>
</section>
<section id="deploy-near-realtime-ric">
<h2>Deploy Near-Realtime RIC<a class="headerlink" href="#deploy-near-realtime-ric" title="Link to this heading"></a></h2>
<p>Deploy the Near-Realtime RIC with the commands below</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/oaic/RIC-Deployment/RECIPE_EXAMPLE/PLATFORM/
git<span class="w"> </span>checkout<span class="w"> </span>e_rel_xapp_onboarder_support
<span class="nb">cd</span><span class="w"> </span>~/oaic/RIC-Deployment/bin
sudo<span class="w"> </span>./deploy-ric-platform<span class="w"> </span>-f<span class="w"> </span>../RECIPE_EXAMPLE/PLATFORM/example_recipe_oran_e_release_modified_e2.yaml
</pre></div>
</div>
<p>Use this command to check all the Kubernetes pods</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-A
</pre></div>
</div>
<p><strong>Make sure that All pods (besides tiller generator) are in the ``1/1 Running`` state before proceeding</strong></p>
</section>
<section id="setup-srslte-with-e2-agent">
<span id="setup-srslte"></span><h2>Setup - Srslte with E2 Agent<a class="headerlink" href="#setup-srslte-with-e2-agent" title="Link to this heading"></a></h2>
<section id="installing-asn1c-compiler">
<h3>Installing Asn1c compiler<a class="headerlink" href="#installing-asn1c-compiler" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/oaic/asn1c
git<span class="w"> </span>checkout<span class="w"> </span>velichkov_s1ap_plus_option_group
autoreconf<span class="w"> </span>-iv
./configure
make<span class="w"> </span>-j<span class="sb">`</span>nproc<span class="sb">`</span>
sudo<span class="w"> </span>make<span class="w"> </span>install
sudo<span class="w"> </span>ldconfig
<span class="nb">cd</span><span class="w"> </span>..
</pre></div>
</div>
</section>
<section id="install-srslte-from-source">
<h3>Install Srslte from source<a class="headerlink" href="#install-srslte-from-source" title="Link to this heading"></a></h3>
<p>Checkout srslte-e2 to ss-xapp-support. This is where the code is updated for the kpm indication for the ss-xapp to work.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/oaic
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/openaicellular/srslte-e2
<span class="nb">cd</span><span class="w"> </span>srslte-e2
git<span class="w"> </span>checkout<span class="w"> </span>ss-xapp-support
rm<span class="w"> </span>-rf<span class="w"> </span>build
mkdir<span class="w"> </span>build
<span class="nb">export</span><span class="w"> </span><span class="nv">SRS</span><span class="o">=</span><span class="sb">`</span>realpath<span class="w"> </span>.<span class="sb">`</span>
<span class="nb">cd</span><span class="w"> </span>build
cmake<span class="w"> </span>../<span class="w"> </span>-DCMAKE_BUILD_TYPE<span class="o">=</span>RelWithDebInfo<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-DRIC_GENERATED_E2AP_BINDING_DIR<span class="o">=</span><span class="si">${</span><span class="nv">SRS</span><span class="si">}</span>/e2_bindings/E2AP-v01.01<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-DRIC_GENERATED_E2SM_KPM_BINDING_DIR<span class="o">=</span><span class="si">${</span><span class="nv">SRS</span><span class="si">}</span>/e2_bindings/E2SM-KPM<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-DRIC_GENERATED_E2SM_GNB_NRT_BINDING_DIR<span class="o">=</span><span class="si">${</span><span class="nv">SRS</span><span class="si">}</span>/e2_bindings/E2SM-GNB-NRT
make<span class="w"> </span>-j<span class="sb">`</span>nproc<span class="sb">`</span>
sudo<span class="w"> </span>make<span class="w"> </span>install
sudo<span class="w"> </span>ldconfig
sudo<span class="w"> </span>srslte_install_configs.sh<span class="w"> </span>user<span class="w"> </span>--force
</pre></div>
</div>
</section>
<section id="setup-nginx-web-server">
<span id="setup-nginx"></span><h3>Setup - Nginx Web Server<a class="headerlink" href="#setup-nginx-web-server" title="Link to this heading"></a></h3>
<p>For this workshop Nginx web server is required to setup a web server for hosting xApp configuration files for xApp deployment</p>
<p>First install Nginx package</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>nginx<span class="w"> </span>-y
</pre></div>
</div>
<p>Check to see if Nginx is in the <code class="docutils literal notranslate"><span class="pre">active</span> <span class="pre">(running)</span></code> state</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>nginx
</pre></div>
</div>
<p>Unlink the default Configuration file and check if it is unlinked</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/etc/nginx/sites-enabled
sudo<span class="w"> </span>unlink<span class="w"> </span>default
<span class="nb">cd</span><span class="w"> </span>../
</pre></div>
</div>
<p>Now we create some directories which can be accessed by the server and where the config files can be hosted</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>../../var/www
sudo<span class="w"> </span>mkdir<span class="w"> </span>xApp_config.local
<span class="nb">cd</span><span class="w"> </span>xApp_config.local/
sudo<span class="w"> </span>mkdir<span class="w"> </span>config_files
</pre></div>
</div>
<p>Create a Custom Configuration File and define file locations</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>../../../etc/nginx/conf.d
sudo<span class="w"> </span>vim<span class="w"> </span>xApp_config.local.conf
</pre></div>
</div>
<p>Paste the following content in the <em>conf</em> file.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>server<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>listen<span class="w"> </span><span class="m">5010</span><span class="w"> </span>default_server<span class="p">;</span>
<span class="w">    </span>server_name<span class="w"> </span>xApp_config.local<span class="p">;</span>
<span class="w">    </span>location<span class="w"> </span>/config_files/<span class="w"> </span><span class="o">{</span>

<span class="w">    </span>root<span class="w"> </span>/var/www/xApp_config.local/<span class="p">;</span>
<span class="w">    </span><span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>
<p>Save the configuration file and check if there are any errors in the configuration file.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>nginx<span class="w"> </span>-t
</pre></div>
</div>
</section>
</section>
<section id="setup-intrusion-detection-with-xapp">
<span id="setup-id"></span><h2>Setup - Intrusion Detection with xApp<a class="headerlink" href="#setup-intrusion-detection-with-xapp" title="Link to this heading"></a></h2>
<section id="modify-srslte">
<h3>Modify Srslte<a class="headerlink" href="#modify-srslte" title="Link to this heading"></a></h3>
<p>You will need to modify srslte to be able to connect with 2 user equipments (UEs). To do this open the <code class="docutils literal notranslate"><span class="pre">user_db.csv</span></code> file with your preferred text editor</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>-i
<span class="nb">cd</span><span class="w"> </span>.config/srslte
vim<span class="w"> </span>user_db.csv
</pre></div>
</div>
<p>Replace these lines of code with text given below. This allows the ENB to be able to connect with 2 UEs. <em>Format of these lines: “Name, Auth, IMSI, Key, OP_Type, OP/OPc, AMF, SQN, QCI, IP_alloc”.</em></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ue2,xor,001010123456780,00112233445566778899aabbccddeeff,opc,63bfa50ee6523365ff14c1f45f88737d,8000,00000000173d,7,dynamic
ue3,xor,001010123456781,00112233445566778899aabbccddeeff,opc,63bfa50ee6523365ff14c1f45f88737d,8002,0000000015f3,7,dynamic
ue4,xor,001010123456782,00112233445566778899aabbccddeeff,opc,63bfa50ee6523365ff14c1f45f88737d,8003,0000000015f4,7,dynamic
ue1,xor,001010123456789,00112233445566778899aabbccddeeff,opc,63bfa50ee6523365ff14c1f45f88737d,9001,000000001404,7,dynamic
</pre></div>
</div>
<p>Exit out of sudo once you are done editing the file</p>
<blockquote>
<div><p>exit</p>
</div></blockquote>
</section>
<section id="installing-xapp">
<h3>Installing xApp<a class="headerlink" href="#installing-xapp" title="Link to this heading"></a></h3>
<p>Clone down the xApp</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/oaic
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/openaicellular/intrusion-detection-xapp.git
</pre></div>
</div>
<p>Create a symlink from the xApp’s config file. This can be replaced by another symlink in the future. Reload Nginx once this has been done.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/oaic/intrusion-detection-xapp
sudo<span class="w"> </span>cp<span class="w"> </span>config-file.json<span class="w"> </span>/var/www/xApp_config.local/config_files/
sudo<span class="w"> </span>systemctl<span class="w"> </span>reload<span class="w"> </span>nginx
</pre></div>
</div>
<p>Now we are going to build the xapp from the <code class="docutils literal notranslate"><span class="pre">DockerFile</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/oaic/intrusion-detection-xapp
sudo<span class="w"> </span>docker<span class="w"> </span>build<span class="w"> </span>.<span class="w"> </span>-t<span class="w"> </span>xApp-registry.local:5008/ss:0.1.0
</pre></div>
</div>
<p>Paste the following in the <code class="docutils literal notranslate"><span class="pre">ss-xapp-onboard.url</span></code> file located in the <code class="docutils literal notranslate"><span class="pre">intrusion-detection-xapp</span></code> directory. Substitute the <code class="docutils literal notranslate"><span class="pre">&lt;machine_ip_addr&gt;</span></code> with the IP address of your machine. You can find this by pasting the command <code class="docutils literal notranslate"><span class="pre">hostname</span> <span class="pre">-I</span> <span class="pre">|</span> <span class="pre">cut</span> <span class="pre">-f1</span> <span class="pre">-d'</span> <span class="pre">'</span></code> in the terminal.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/oaic/intrusion-detection-xapp
vim<span class="w"> </span>ss-xapp-onboard.url
</pre></div>
</div>
<p>Paste the following in url file. <strong>Remember to change Ip address</strong></p>
<blockquote>
<div><p>{“config-file.json_url”:”<a class="reference external" href="http:/">http:/</a>/&lt;machine_ip_addr&gt;:5010/config_files/config-file.json”}</p>
</div></blockquote>
</section>
</section>
<section id="setup-5g-network">
<h2>Setup - 5G Network<a class="headerlink" href="#setup-5g-network" title="Link to this heading"></a></h2>
<section id="srsepc">
<h3>Srsepc<a class="headerlink" href="#srsepc" title="Link to this heading"></a></h3>
<p><strong>Terminal 1</strong>: Start the Core Network/Add UEs to Network Namespace</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>ip<span class="w"> </span>netns<span class="w"> </span>add<span class="w"> </span>ue1
sudo<span class="w"> </span>ip<span class="w"> </span>netns<span class="w"> </span>add<span class="w"> </span>ue2
sudo<span class="w"> </span>ip<span class="w"> </span>netns<span class="w"> </span>add<span class="w"> </span>ue3
sudo<span class="w"> </span>ip<span class="w"> </span>netns<span class="w"> </span>add<span class="w"> </span>ue4
sudo<span class="w"> </span>ip<span class="w"> </span>netns<span class="w"> </span>list
sudo<span class="w"> </span>srsepc
</pre></div>
</div>
</section>
<section id="srsenb">
<h3>Srsenb<a class="headerlink" href="#srsenb" title="Link to this heading"></a></h3>
<p><strong>Terminal 2</strong>: Set up Environment Variables and Base Station</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">E2NODE_IP</span><span class="o">=</span><span class="sb">`</span>hostname<span class="w">  </span>-I<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-f1<span class="w"> </span>-d<span class="s1">&#39; &#39;</span><span class="sb">`</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">E2NODE_PORT</span><span class="o">=</span><span class="m">5006</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">E2TERM_IP</span><span class="o">=</span><span class="sb">`</span>sudo<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>ricplt<span class="w"> </span>--field-selector<span class="w"> </span>metadata.name<span class="o">=</span>service-ricplt-e2term-sctp-alpha<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.items[0].spec.clusterIP}&#39;</span><span class="sb">`</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>srsenb<span class="w"> </span>--enb.n_prb<span class="o">=</span><span class="m">100</span><span class="w"> </span>--enb.name<span class="o">=</span>enb1<span class="w"> </span>--enb.enb_id<span class="o">=</span>0x19B<span class="w"> </span><span class="se">\</span>
--rf.device_name<span class="o">=</span>zmq<span class="w"> </span>--rf.device_args<span class="o">=</span><span class="s2">&quot;fail_on_disconnect=true,tx_port=tcp://*:2000,rx_port=tcp://localhost:2009,id=enb,base_srate=23.04e6&quot;</span><span class="w"> </span>--ric.agent.remote_ipv4_addr<span class="o">=</span><span class="si">${</span><span class="nv">E2TERM_IP</span><span class="si">}</span><span class="w"> </span>--log.all_level<span class="o">=</span>warn<span class="w"> </span>--ric.agent.log_level<span class="o">=</span>debug<span class="w"> </span>--log.filename<span class="o">=</span>stdout<span class="w"> </span>--ric.agent.local_ipv4_addr<span class="o">=</span><span class="si">${</span><span class="nv">E2NODE_IP</span><span class="si">}</span><span class="w"> </span>--ric.agent.local_port<span class="o">=</span><span class="si">${</span><span class="nv">E2NODE_PORT</span><span class="si">}</span><span class="w"> </span>--slicer.enable<span class="o">=</span><span class="m">1</span><span class="w"> </span>--slicer.workshare<span class="o">=</span><span class="m">0</span>
</pre></div>
</div>
<p><strong>Make sure you can see the eNB have a RIC State Establish message as shown in the image below before proceeding.</strong></p>
<p>If you are not getting a RIC State Established message, you need to restart the e2term-alpha pod by using the command: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">kubectl</span> <span class="pre">delete</span> <span class="pre">pod</span> <span class="pre">-n</span> <span class="pre">ricplt</span> <span class="pre">-l</span> <span class="pre">app=ricplt-e2term-alpha</span></code>. If that still doesn’t work, undeploy and redeploy the near-realtime RIC.</p>
</section>
<section id="srsue">
<h3>Srsue<a class="headerlink" href="#srsue" title="Link to this heading"></a></h3>
<p><strong>Terminal 3</strong>: Set up the first UE</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>srsue<span class="w"> </span><span class="se">\</span>
--rf.device_name<span class="o">=</span>zmq<span class="w"> </span>--rf.device_args<span class="o">=</span><span class="s2">&quot;tx_port=tcp://*:2010,rx_port=tcp://localhost:2300,id=ue,base_srate=23.04e6&quot;</span><span class="w"> </span>--usim.algo<span class="o">=</span>xor<span class="w"> </span>--usim.imsi<span class="o">=</span><span class="m">001010123456789</span><span class="w"> </span>--usim.k<span class="o">=</span>00112233445566778899aabbccddeeff<span class="w"> </span>--usim.imei<span class="o">=</span><span class="m">353490069873310</span><span class="w"> </span>--log.all_level<span class="o">=</span>warn<span class="w"> </span>--log.filename<span class="o">=</span>stdout<span class="w"> </span>--gw.netns<span class="o">=</span>ue1
</pre></div>
</div>
<p><strong>Terminal 4</strong>: Set up the second UE</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>srsue<span class="w"> </span><span class="se">\</span>
--rf.device_name<span class="o">=</span>zmq<span class="w"> </span>--rf.device_args<span class="o">=</span><span class="s2">&quot;tx_port=tcp://*:2007,rx_port=tcp://localhost:2400,id=ue,base_srate=23.04e6&quot;</span><span class="w"> </span>--usim.algo<span class="o">=</span>xor<span class="w"> </span>--usim.imsi<span class="o">=</span><span class="m">001010123456780</span><span class="w"> </span>--usim.k<span class="o">=</span>00112233445566778899aabbccddeeff<span class="w"> </span>--usim.imei<span class="o">=</span><span class="m">353490069873310</span><span class="w"> </span>--log.all_level<span class="o">=</span>warn<span class="w"> </span>--log.filename<span class="o">=</span>stdout<span class="w"> </span>--gw.netns<span class="o">=</span>ue2
</pre></div>
</div>
<p><strong>Terminal 5</strong>: Set up the third UE</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>srsue<span class="w"> </span><span class="se">\</span>
--rf.device_name<span class="o">=</span>zmq<span class="w"> </span>--rf.device_args<span class="o">=</span><span class="s2">&quot;tx_port=tcp://*:2008,rx_port=tcp://localhost:2500,id=ue,base_srate=23.04e6&quot;</span><span class="w"> </span>--usim.algo<span class="o">=</span>xor<span class="w"> </span>--usim.imsi<span class="o">=</span><span class="m">001010123456781</span><span class="w"> </span>--usim.k<span class="o">=</span>00112233445566778899aabbccddeeff<span class="w"> </span>--usim.imei<span class="o">=</span><span class="m">353490069873310</span><span class="w"> </span>--log.all_level<span class="o">=</span>warn<span class="w"> </span>--log.filename<span class="o">=</span>stdout<span class="w"> </span>--gw.netns<span class="o">=</span>ue3
</pre></div>
</div>
<p><strong>Terminal 6</strong>: Set up the fourth UE</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>srsue<span class="w"> </span><span class="se">\</span>
--rf.device_name<span class="o">=</span>zmq<span class="w"> </span>--rf.device_args<span class="o">=</span><span class="s2">&quot;tx_port=tcp://*:2011,rx_port=tcp://localhost:2600,id=ue,base_srate=23.04e6&quot;</span><span class="w"> </span>--usim.algo<span class="o">=</span>xor<span class="w"> </span>--usim.imsi<span class="o">=</span><span class="m">001010123456782</span><span class="w"> </span>--usim.k<span class="o">=</span>00112233445566778899aabbccddeeff<span class="w"> </span>--usim.imei<span class="o">=</span><span class="m">353490069873310</span><span class="w"> </span>--log.all_level<span class="o">=</span>warn<span class="w"> </span>--log.filename<span class="o">=</span>stdout<span class="w"> </span>--gw.netns<span class="o">=</span>ue4
</pre></div>
</div>
</section>
<section id="gnuradio">
<h3>Gnuradio<a class="headerlink" href="#gnuradio" title="Link to this heading"></a></h3>
<p><strong>Terminal 7</strong>: Run the Gnuradio script</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/oaic/intrusion-detection-xapp
python3<span class="w"> </span>four_ue.py
</pre></div>
</div>
<p><strong>Make sure the UEs are connected with an Ip address before proceeding</strong></p>
</section>
<section id="iperf3">
<h3>Iperf3<a class="headerlink" href="#iperf3" title="Link to this heading"></a></h3>
<p><strong>Execute the next commands each in a separate terminal</strong></p>
<p><strong>Terminal 8-11</strong>: Set up iperf3 test on the server side</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>iperf3<span class="w"> </span>-s<span class="w"> </span>-B<span class="w"> </span><span class="m">172</span>.16.0.1<span class="w"> </span>-p<span class="w"> </span><span class="m">5006</span><span class="w"> </span>-i<span class="w"> </span><span class="m">1</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>iperf3<span class="w"> </span>-s<span class="w"> </span>-B<span class="w"> </span><span class="m">172</span>.16.0.1<span class="w"> </span>-p<span class="w"> </span><span class="m">5020</span><span class="w"> </span>-i<span class="w"> </span><span class="m">1</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>iperf3<span class="w"> </span>-s<span class="w"> </span>-B<span class="w"> </span><span class="m">172</span>.16.0.1<span class="w"> </span>-p<span class="w"> </span><span class="m">5021</span><span class="w"> </span>-i<span class="w"> </span><span class="m">1</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>iperf3<span class="w"> </span>-s<span class="w"> </span>-B<span class="w"> </span><span class="m">172</span>.16.0.1<span class="w"> </span>-p<span class="w"> </span><span class="m">5022</span><span class="w"> </span>-i<span class="w"> </span><span class="m">1</span>
</pre></div>
</div>
<p><strong>Execute the next commands each in separate terminals as well</strong></p>
<p><strong>Terminal 12-15</strong>: Set up iperf3 test on the client side</p>
<p>We add an additional bandwidth argument “-b xxM” on each iperf3 test on client side to create a scenario of UEs trying to access more or less of resources on the network. If a UE surpasses the trained data rate, it is considered as malicious by the xApp.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>ip<span class="w"> </span>netns<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>ue1<span class="w"> </span>iperf3<span class="w"> </span>-c<span class="w"> </span><span class="m">172</span>.16.0.1<span class="w"> </span>-p<span class="w"> </span><span class="m">5006</span><span class="w"> </span>-i<span class="w"> </span><span class="m">1</span><span class="w"> </span>-t<span class="w"> </span><span class="m">36000</span><span class="w"> </span>-R<span class="w"> </span>-b<span class="w"> </span>1M
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>ip<span class="w"> </span>netns<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>ue2<span class="w"> </span>iperf3<span class="w"> </span>-c<span class="w"> </span><span class="m">172</span>.16.0.1<span class="w"> </span>-p<span class="w"> </span><span class="m">5020</span><span class="w"> </span>-i<span class="w"> </span><span class="m">1</span><span class="w"> </span>-t<span class="w"> </span><span class="m">36000</span><span class="w"> </span>-R<span class="w"> </span>-b<span class="w"> </span>1M
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>ip<span class="w"> </span>netns<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>ue3<span class="w"> </span>iperf3<span class="w"> </span>-c<span class="w"> </span><span class="m">172</span>.16.0.1<span class="w"> </span>-p<span class="w"> </span><span class="m">5021</span><span class="w"> </span>-i<span class="w"> </span><span class="m">1</span><span class="w"> </span>-t<span class="w"> </span><span class="m">36000</span><span class="w"> </span>-R<span class="w"> </span>-b<span class="w"> </span>1M
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>ip<span class="w"> </span>netns<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>ue4<span class="w"> </span>iperf3<span class="w"> </span>-c<span class="w"> </span><span class="m">172</span>.16.0.1<span class="w"> </span>-p<span class="w"> </span><span class="m">5022</span><span class="w"> </span>-i<span class="w"> </span><span class="m">1</span><span class="w"> </span>-t<span class="w"> </span><span class="m">36000</span><span class="w"> </span>-R<span class="w"> </span>-b<span class="w"> </span>1M
</pre></div>
</div>
<p><strong>You should notice traffic flow on both the server and client side for all UEs.</strong></p>
</section>
</section>
<section id="deploying-the-xapp">
<span id="deploying"></span><h2>Deploying the xApp<a class="headerlink" href="#deploying-the-xapp" title="Link to this heading"></a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/oaic/intrusion-detection-xapp
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">KONG_PROXY</span><span class="o">=</span><span class="sb">`</span>sudo<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>ricplt<span class="w"> </span>-l<span class="w"> </span>app.kubernetes.io/name<span class="o">=</span>kong<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.items[0].spec.clusterIP}&#39;</span><span class="sb">`</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">E2MGR_HTTP</span><span class="o">=</span><span class="sb">`</span>sudo<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>ricplt<span class="w"> </span>--field-selector<span class="w"> </span>metadata.name<span class="o">=</span>service-ricplt-e2mgr-http<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.items[0].spec.clusterIP}&#39;</span><span class="sb">`</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">APPMGR_HTTP</span><span class="o">=</span><span class="sb">`</span>sudo<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>ricplt<span class="w"> </span>--field-selector<span class="w"> </span>metadata.name<span class="o">=</span>service-ricplt-appmgr-http<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.items[0].spec.clusterIP}&#39;</span><span class="sb">`</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">E2TERM_SCTP</span><span class="o">=</span><span class="sb">`</span>sudo<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>ricplt<span class="w"> </span>--field-selector<span class="w"> </span>metadata.name<span class="o">=</span>service-ricplt-e2term-sctp-alpha<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.items[0].spec.clusterIP}&#39;</span><span class="sb">`</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">ONBOARDER_HTTP</span><span class="o">=</span><span class="sb">`</span>sudo<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>ricplt<span class="w"> </span>--field-selector<span class="w"> </span>metadata.name<span class="o">=</span>service-ricplt-xapp-onboarder-http<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.items[0].spec.clusterIP}&#39;</span><span class="sb">`</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">RTMGR_HTTP</span><span class="o">=</span><span class="sb">`</span>sudo<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>ricplt<span class="w"> </span>--field-selector<span class="w"> </span>metadata.name<span class="o">=</span>service-ricplt-rtmgr-http<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.items[0].spec.clusterIP}&#39;</span><span class="sb">`</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-L<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span><span class="s2">&quot;http://</span><span class="nv">$KONG_PROXY</span><span class="s2">:32080/onboard/api/v1/onboard/download&quot;</span><span class="w"> </span>--header<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span>--data-binary<span class="w"> </span><span class="s2">&quot;@ss-xapp-onboard.url&quot;</span>
curl<span class="w"> </span>-L<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="s2">&quot;http://</span><span class="nv">$KONG_PROXY</span><span class="s2">:32080/onboard/api/v1/charts&quot;</span>
curl<span class="w"> </span>-L<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span><span class="s2">&quot;http://</span><span class="nv">$KONG_PROXY</span><span class="s2">:32080/appmgr/ric/v1/xapps&quot;</span><span class="w"> </span>--header<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span>--data-raw<span class="w"> </span><span class="s1">&#39;{&quot;xappName&quot;: &quot;ss&quot;}&#39;</span>
</pre></div>
</div>
<p><strong>If you are repeating an experiement, you may want to restart the pod using the command below. By doing so, you do not have to undeploy and redeploy the xApp again.</strong>
.. code-block:: bash</p>
<blockquote>
<div><p>sudo kubectl -n ricxapp rollout restart deployment ricxapp-ss</p>
</div></blockquote>
</section>
<section id="running-the-xapp">
<span id="id2"></span><h2>Running the xApp<a class="headerlink" href="#running-the-xapp" title="Link to this heading"></a></h2>
<p><strong>Terminal 16</strong>: In your EPC &amp; eNB server’s terminal, print the logs for the SS xApp</p>
<p><strong>The xApp has to be deployed in order for this to work.</strong>
.. code-block:: bash</p>
<blockquote>
<div><p>sudo kubectl logs -f -n ricxapp -l app=ricxapp-ss</p>
</div></blockquote>
<p><strong>Terminal 17</strong>: Now run the test script with the following commands on a separate terminal.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/oaic/intrusion-detection-xapp
sudo<span class="w"> </span>chmod<span class="w"> </span>+x<span class="w"> </span>zmqfourue.sh
sudo<span class="w"> </span>./zmqfourue.sh
</pre></div>
</div>
<p>To run the script again, you have to restart the xApp and redeploy the network again.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>kubectl<span class="w"> </span>-n<span class="w"> </span>ricxapp<span class="w"> </span>rollout<span class="w"> </span>restart<span class="w"> </span>deployment<span class="w"> </span>ricxapp-ss
</pre></div>
</div>
<p><strong>Rerunning the xapp now requires deleting the pods manually if CUDA has been enabled</strong></p>
<p>Use <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">kubectl</span> <span class="pre">get</span> <span class="pre">pods</span> <span class="pre">-A</span></code> to see the active pods</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">kubectl</span> <span class="pre">delete</span> <span class="pre">pod</span> <span class="pre">ricxapp-ss-XXX</span> <span class="pre">-n</span> <span class="pre">ricxapp</span></code> change the XXX the correct pod name</p>
<p>The correct pod to delete should be in the “running” state</p>
<p>There is a flag in the intrustionDetection.py file called “trained” that is set to false by default. When false the model will train before doing
the inference for the intrusion detection. If you only want to do the inference set it to “True”.</p>
<p>If running the intrustion detection with the iperf3 commands above, there should be no malicious ue. Two anomalies are required
per ue for it to be considered malicious. There is a script called iperfThrottleTest.sh that will throttle the iperf3 client and cause a malicious
UE to appear.</p>
<p>Replace:
.. code-block:: bash</p>
<blockquote>
<div><p>sudo ip netns exec ue1 iperf3 -c 172.16.0.1 -p 5006 -i 1 -t 36000 -R -b 1M</p>
</div></blockquote>
<p>With. While the xappp is in inference mode:
.. code-block:: bash</p>
<blockquote>
<div><p>cd oaic/intrusion-detection-xapp
./iperfThrottleTest.sh</p>
</div></blockquote>
</section>
<section id="getting-cuda-on-the-app">
<h2>Getting CUDA On The App<a class="headerlink" href="#getting-cuda-on-the-app" title="Link to this heading"></a></h2>
<p>To run the xApp with GPU support follow these steps</p>
<p>Make sure the correct NVIDIA drivers are installed and install NVIDIA container toolkit:
.. code-block:: bash</p>
<blockquote>
<div><p>curl -fsSL <a class="reference external" href="https://nvidia.github.io/libnvidia-container/gpgkey">https://nvidia.github.io/libnvidia-container/gpgkey</a> | sudo gpg –dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg &amp;&amp; curl -s -L <a class="reference external" href="https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list">https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list</a> | sed ‘s#deb <a class="reference external" href="https://#deb">https://#deb</a> [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] <a class="reference external" href="https://#g">https://#g</a>’ | sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list</p>
<p>sudo apt-get update
sudo apt-get install -y nvidia-container-toolkit</p>
</div></blockquote>
</section>
<section id="configure-docker-to-run-with-cuda">
<h2>Configure Docker to Run with CUDA<a class="headerlink" href="#configure-docker-to-run-with-cuda" title="Link to this heading"></a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>nvidia-ctk<span class="w"> </span>runtime<span class="w"> </span>configure<span class="w"> </span>--runtime<span class="o">=</span>docker
sudo<span class="w"> </span>systemctl<span class="w"> </span>daemon-reload
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>docker
</pre></div>
</div>
<p>The kubernetes node should now show the GPU as allocatable. Run the commands below to check
.. code-block:: bash</p>
<blockquote>
<div><p>sudo kubectl get nodes
sudo kubectl describe node &lt;node-name&gt;</p>
</div></blockquote>
<p>You should see something along the lines of:</p>
<blockquote>
<div><dl class="simple">
<dt>allocatable:</dt><dd><p>nvidia.com/gpu: 1</p>
</dd>
</dl>
</div></blockquote>
<p>If the GPU is allocatable run:
.. code-block:: bash</p>
<blockquote>
<div><p>sudo kubectl get deployment ricxapp-ss -n ricxapp -o yaml &gt; deploymentGPU.yaml
nano deploymentGPU.yaml</p>
</div></blockquote>
<p>Update the the resources limits requests and add:
.. code-block:: bash</p>
<blockquote>
<div><dl class="simple">
<dt>resources:</dt><dd><dl class="simple">
<dt>requests:</dt><dd><p>nvidia.com/gpu: 1</p>
</dd>
<dt>limits:</dt><dd><p>nvidia.com/gpu: 1</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<p>Run the following command to update the configuration:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>deploymentGPU.yaml
</pre></div>
</div>
<p>The Intrustion Detection program should now detect the GPU</p>
<p><strong>NOTE: do not replace what is already there</strong></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ssxapp.html" class="btn btn-neutral float-left" title="Running the SS Xapp" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="undeploy_ric.html" class="btn btn-neutral float-right" title="UnDeploying RIC Platform" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, OAIC.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>