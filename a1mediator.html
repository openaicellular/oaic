<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>A1 Mediator Installation Guide &mdash; OAIC 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=2709fde1"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            OAIC
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="oaic_features.html">OAIC Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Background Information:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="background_cloud.html">Background on Docker, Kubernetes &amp; Helm</a></li>
<li class="toctree-l1"><a class="reference internal" href="background_oran_architecture.html">O-RAN Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="background_srsRAN.html">RAN Architecture</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation Procedures:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">Hardware and Software Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="oran_installation.html">O-RAN Near-Real Time RIC Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="srsRAN_installation.html">srsRAN with E2 Agent Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup5gnetwork.html">Setup your own 5G Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="MultipleUEs.html">Multiples UEs ZMQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="nonrtric.html">O-RAN Non-Real Time RIC Installation Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">xApp Deployment:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="example_xapp_deployment.html">KPIMON xApp Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="xapp_deployment.html">xApp Deployment - General Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="nexran1.html">Running the Nexran Xapp</a></li>
<li class="toctree-l1"><a class="reference internal" href="ssxapp.html">Running the SS Xapp</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="undeploy_ric.html">UnDeploying RIC Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="srsRAN_additional_features.html">srsRAN Additional Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="kubectl_commands.html">Kubectl Commands - Cheat Sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="oaic_t.html">OAIC-T</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">2024 OAIC Workshop</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="2024_workshop_gcp.html">Day 1 - Google Cloud Platform Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="2024_workshop_ss.html">Day 1 - Secure Slicing xApp</a></li>
<li class="toctree-l1"><a class="reference internal" href="xapp_python.html">Day 2 - Developing a custom xApp in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="edgeric-workshop-tutorial.html">Day 2 - EdgeRIC tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="OAIC-2024-Workshop-oai-flexric-documentation.html">Day 2 - OAI/FlexRIC Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="OAIC-T-fast-setup.html">Day 3 - OAIC-T</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">OAIC</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">A1 Mediator Installation Guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/a1mediator.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="a1-mediator-installation-guide">
<h1>A1 Mediator Installation Guide<a class="headerlink" href="#a1-mediator-installation-guide" title="Link to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>The RAN Intelligent Controller (RIC) Platform’s A1 Mediator component
listens for policy type and policy instance requests sent via HTTP
(the “northbound” interface), and publishes those requests to running
xApps via RMR messages (the “southbound” interface).</p>
<section id="code">
<h3>Code<a class="headerlink" href="#code" title="Link to this heading"></a></h3>
<p>To get started with the code clone the code:</p>
<p><a class="reference external" href="https://github.com/openaicellular/ric-plt-a1">https://github.com/openaicellular/ric-plt-a1</a></p>
</section>
<section id="policy-overview">
<h3>Policy Overview<a class="headerlink" href="#policy-overview" title="Link to this heading"></a></h3>
<p>There are two “object types” associated with policy: policy types and
policy instances.</p>
<section id="policy-types">
<h4>Policy Types<a class="headerlink" href="#policy-types" title="Link to this heading"></a></h4>
<p>Policy types define the name, description, and most importantly the
schema of all instances of that type.  Think of policy types as
defining a JSON schema for the messages sent from A1 to xapps.  Xapps
do not receive policy types from A1; types are used only by A1 to
validate instance creation requests.  However, xapps must register to
receive instances of type ids in their xapp descriptor.  Xapp
developers can also create new policy types, though the exact process
of where these are stored is still TBD.  For practical purposes, when
the RIC is running, A1s API needs to be invoked to load the policy
types before instances can be created.  Xapps can “sign up” for
multiple policy types using their xapp descriptor.</p>
</section>
<section id="policy-instances">
<h4>Policy Instances<a class="headerlink" href="#policy-instances" title="Link to this heading"></a></h4>
<p>Policy instances are concrete instantiations of a policy type. They
give concrete values of a policy.  There may be many instances of a
single type. Whenever a policy instance is created in A1, messages are
sent over RMR to all xapps registered for that policy type; see below.
Xapps are expected to handle multiple simultaneous instances of each
type that they are registered for.</p>
</section>
</section>
<section id="known-differences-from-a1-1-0-0-spec">
<h3>Known differences from A1 1.0.0 spec<a class="headerlink" href="#known-differences-from-a1-1-0-0-spec" title="Link to this heading"></a></h3>
<p>This is a list of some of the known differences between the API here
and the a1 spec dated 2019.09.30.  In some cases, the spec is
deficient and RIC is “ahead”, in other cases this does not yet conform
to recent spec changes.</p>
<ol class="arabic simple">
<li><p>[RIC is ahead] There is no notion of policy types in the spec,
however this aspect is quite critical for the intended use of the
RIC, where many Xapps may implement the same policy, and new Xapps
may be created often that define new types. Moreover, policy types
define the schema for policy instances, and without types, A1
cannot validate whether instances are valid, which the RIC A1m
does. The RIC A1 Mediator view of things is that, there are a set
of schemas, called policy types, and one or more instances of each
schema can be created. Instances are validated against types. The
spec currently provides no mechanism for the implementation of A1
to know whether policy [instances] are correct since there is no
schema for them. This difference has the rather large consequence
that none of the RIC A1m URLs match the spec.</p></li>
<li><p>[RIC is ahead] There is a rich status URL in the RIC A1m for policy
instances, but this is not in the spec.</p></li>
<li><p>[RIC is ahead] There is a state machine for when instances are
actually deleted from the RIC (at which point all URLs referencing
it are a 404); this is a configurable option when deploying the RIC
A1m.</p></li>
<li><p>[CR coming to spec] The spec contains a PATCH for partially
updating a policy instance, and creating/deleting multiple
instances, however the team agreed to remove this from a later
version of the Spec. The RIC A1m does not have this operation.</p></li>
<li><p>[Spec is ahead] The RIC A1 PUT bodies for policy instances do not
exactly conform to the “scope” and “statements” block that the spec
defines. They are very close otherwise, however.   (I would argue
some of the spec is redundant; for example “policy [instance] id”
is a key inside the PUT body to create an instance, but it is
already in the URL.)</p></li>
<li><p>[Spec is ahead] The RIC A1m does not yet notify external clients
when instance statuses change.</p></li>
<li><p>[Spec is ahead] The spec defines that a query of all policy
instances should return the full bodies, however right now the RIC
A1m returns a list of IDs (assuming subsequent queries can fetch
the bodies).</p></li>
<li><p>[?] The spec document details some very specific “types”, but the
RIC A1m allows these to be loaded in (see #1). For example, spec
section 4.2.6.2. We believe this should be removed from the spec
and rather defined as a type. Xapps can be created that define new
types, so the spec will quickly become “stale” if “types” are
defined in the spec.</p></li>
</ol>
</section>
<section id="resiliency">
<h3>Resiliency<a class="headerlink" href="#resiliency" title="Link to this heading"></a></h3>
<p>A1 is resilient to the majority of failures, but not all currently
(though a solution is known).</p>
<p>A1 uses the RIC SDL library to persist all policy state information:
this includes the policy types, policy instances, and policy statuses.
If state is built up in A1, and A1 fails (where Kubernetes will then
restart it), none of this state is lost.</p>
<p>The tiny bit of state that <em>is currently</em> in A1 (volatile) is its
“next second” job queue.  Specifically, when policy instances are
created or deleted, A1 creates jobs in a job queue (in memory).  An
rmr thread polls that thread every second, dequeues the jobs, and
performs them.</p>
<p>If A1 were killed at <em>exactly</em> the right time, you could have jobs
lost, meaning the PUT or DELETE of an instance wouldn’t actually take.
This isn’t drastic, as the operations are idempotent and could always
be re-performed.</p>
<p>In order for A1 to be considered completely resilient, this job queue
would need to be moved to SDL.  SDL uses Redis as a backend, and Redis
natively supports queues via LIST, LPUSH, RPOP.  I’ve asked the SDL
team to consider an extension to SDL to support these Redis
operations.</p>
</section>
</section>
<section id="installation-guide">
<h2>Installation Guide<a class="headerlink" href="#installation-guide" title="Link to this heading"></a></h2>
<section id="environment-variables">
<h3>Environment Variables<a class="headerlink" href="#environment-variables" title="Link to this heading"></a></h3>
<p>You can set the following environment variables when launching a container to change the A1 behavior:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">A1_RMR_RETRY_TIMES</span></code>: the number of times failed rmr operations such as timeouts and send failures should be retried before A1 gives up and returns a 503. The default is <code class="docutils literal notranslate"><span class="pre">4</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">INSTANCE_DELETE_NO_RESP_TTL</span></code>: Please refer to the delete flowchart in docs/; this is <code class="docutils literal notranslate"><span class="pre">T1</span></code> there. The default is 5 (seconds). Basically, the number of seconds that a1 waits to remove an instance from the database after a delete is called in the case that no downstream apps responded.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">INSTANCE_DELETE_RESP_TTL</span></code>: Please refer to the delete flowchart in docs/; this is <code class="docutils literal notranslate"><span class="pre">T2</span></code> there. The default is 5 (seconds). Basically, the number of seconds that a1 waits to remove an instance from the database after a delete is called in the case that downstream apps responded.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">USE_FAKE_SDL</span></code>: This allows testing of the A1 feature without a DBaaS SDL container.  The default is False.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">prometheus_multiproc_dir</span></code>: The directory where Prometheus gathers metrics.  The default is /tmp.</p></li>
</ol>
</section>
<section id="kubernetes-deployment">
<h3>Kubernetes Deployment<a class="headerlink" href="#kubernetes-deployment" title="Link to this heading"></a></h3>
<p>The official Helm chart for the A1 Mediator is in a deployment repository, which holds all of the Helm charts
for the RIC platform. There is a helm chart in <cite>integration_tests</cite> here for running the integration tests as
discussed above.</p>
</section>
<section id="local-deployment">
<h3>Local Deployment<a class="headerlink" href="#local-deployment" title="Link to this heading"></a></h3>
<p>Build and run the A1 mediator locally using the docker CLI as follows.</p>
<section id="build-the-image">
<h4>Build the image<a class="headerlink" href="#build-the-image" title="Link to this heading"></a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">build</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">cache</span> <span class="o">-</span><span class="n">t</span> <span class="n">a1</span><span class="p">:</span><span class="n">latest</span> <span class="o">.</span>
</pre></div>
</div>
</section>
<section id="start-the-container">
<span id="running-1"></span><h4>Start the container<a class="headerlink" href="#start-the-container" title="Link to this heading"></a></h4>
<p>The A1 container depends on a companion DBaaS (SDL) container, but if that is not convenient set
an environment variable as shown below to mock that service.  Also a sample RMR routing table is
supplied in file <cite>local.rt</cite> for mounting as a volume.  The following command uses both:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">e</span> <span class="n">USE_FAKE_SDL</span><span class="o">=</span><span class="kc">True</span> <span class="o">-</span><span class="n">p</span> <span class="mi">10000</span><span class="p">:</span><span class="mi">10000</span> <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">local</span><span class="o">.</span><span class="n">rt</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">route</span><span class="o">/</span><span class="n">local</span><span class="o">.</span><span class="n">rt</span> <span class="n">a1</span><span class="p">:</span><span class="n">latest</span>
</pre></div>
</div>
</section>
<section id="view-container-api">
<h4>View container API<a class="headerlink" href="#view-container-api" title="Link to this heading"></a></h4>
<p>A web user interface generated from the OpenAPI specification can be accessed at this URL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">docker</span><span class="o">-</span><span class="n">host</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="ow">or</span><span class="o">-</span><span class="n">ip</span><span class="p">:</span><span class="mi">10000</span><span class="o">/</span><span class="n">ui</span>
</pre></div>
</div>
</section>
<section id="check-container-health">
<h4>Check container health<a class="headerlink" href="#check-container-health" title="Link to this heading"></a></h4>
<p>The following command requests the container health.  Expect an internal server error if the
Storage Data Layer (SDL) service is not available or has not been mocked as shown above.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="n">docker</span><span class="o">-</span><span class="n">host</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="ow">or</span><span class="o">-</span><span class="n">ip</span><span class="p">:</span><span class="mi">10000</span><span class="o">/</span><span class="n">a1</span><span class="o">-</span><span class="n">p</span><span class="o">/</span><span class="n">healthcheck</span>
</pre></div>
</div>
<p>For more detailed instruction visit: <a class="reference external" href="https://docs.o-ran-sc.org/projects/o-ran-sc-ric-plt-a1/en/latest/index.html">https://docs.o-ran-sc.org/projects/o-ran-sc-ric-plt-a1/en/latest/index.html</a></p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, OAIC.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>